<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eric Xiao | Robotic Pipette End Effector</title>
    <link rel="icon" href="../images/logo.svg" type="image/svg+xml">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Modern CSS -->
    <link rel="stylesheet" href="../assets/css/modern.css">
    
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav" id="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="../index.html" class="nav-logo">Eric Xiao</a>
                <a href="../resume.html" class="nav-resume">
                    <span class="resume-text">Resume</span>
                </a>
            </div>

            <ul class="nav-menu" id="nav-menu">
                <li><a href="../resume.html" class="nav-link nav-link-mobile-only">Resume</a></li>
                <li><a href="../index.html" class="nav-link">Home</a></li>
                <li><a href="../mechanical.html" class="nav-link active">Mechanical</a></li>
                <li><a href="../software.html" class="nav-link">Software</a></li>
                <li><a href="../message.html" class="nav-link">Contact</a></li>
            </ul>

            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Project Details Section -->
    <section class="section" style="min-height: auto; padding-top: 120px;">
        <div class="container">
            <!-- Project Header -->
            <div class="section-header">
                <div style="display: flex; align-items: center; justify-content: center; gap: var(--space-md); flex-wrap: wrap; margin-bottom: var(--space-md);">
                    <h1 class="section-title" style="margin-bottom: 0;">Robotic Pipette End Effector</h1>
                    <span style="background: var(--text-secondary); color: var(--bg-primary); padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); font-weight: var(--font-weight-medium); font-size: 0.875rem;">
                        <i class="fas fa-check-circle"></i> In Service
                    </span>
                </div>
                <p class="section-subtitle">
                    High-precision robotic liquid handling system achieving 5μL accuracy for scientific research applications - Developed Summer 2025 at Brookhaven National Laboratory
                </p>
            </div>

            <!-- Main Project Image -->
            <div style="margin-bottom: var(--space-3xl);">
                <img src="../images/mechanical/RoboticPipette/pipettor_on_ur5e.png" alt="Robotic Pipette End Effector on UR5e"
                     class="lightbox-trigger"
                     style="width: 100%; max-height: 400px; object-fit: cover; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);"
                     onclick="openLightbox(this)">
            </div>

            <!-- Project Content -->
            <div style="max-width: 900px; margin: 0 auto;">
                <!-- Project Overview -->
                <div id="project-overview" style="background: var(--card-bg); padding: var(--space-2xl); border-radius: var(--radius-lg); border: 1px solid var(--border-color); margin-bottom: var(--space-2xl);">
                    <h2 style="color: var(--accent-primary); margin-bottom: var(--space-lg);">
                        <i class="fas fa-flask"></i>
                        Project Overview
                    </h2>
                    <p style="color: var(--text-secondary);">
                        Industrial robots excel at precise movement but lack the fine liquid handling capabilities needed for scientific research protocols.
                        This project developed a custom end effector enabling microliter-precision liquid handling through integration of 3D printed mechanical
                        actuators, embedded RS485 communication, and ROS2 software stack. The system achieves 5μL ±0.5μL accuracy while maintaining compatibility
                        with standard laboratory pipettes and the UR5e tool exchanger system.
                    </p>
                </div>

                <!-- Mechanical Engineering Section -->
                <div id="mechanical-focus" style="background: var(--bg-secondary); padding: var(--space-2xl); border-radius: var(--radius-lg); margin-bottom: var(--space-2xl);">
                    <h2 style="color: var(--accent-primary); margin-bottom: var(--space-lg);">
                        <i class="fas fa-cog"></i>
                        Mechanical Engineering Solution
                    </h2>
                    

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-xl); margin-bottom: var(--space-xl);" class="responsive-grid-2">
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">Quick Swap Mechanism</h3>
                            <p style="color: var(--text-secondary); margin-bottom: var(--space-md);">
                                Enables rapid pipette changes between different volumes without interrupting automated workflows.
                            </p>
                            <ul style="color: var(--text-secondary); margin-left: var(--space-lg); list-style-type: disc;">
                                <li><strong>Locking mechanism</strong> - Engagement during operation</li>
                                <li><strong>Pipette compatibility</strong> - Works with standard laboratory pipettes</li>
                                <li><strong>Positioning</strong> - Alignment for accuracy</li>
                            </ul>
                        </div>
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">Dual Actuator System</h3>
                            <p style="color: var(--text-secondary); margin-bottom: var(--space-md);">
                                Two independent 3D printed actuators replicate human pipetting actions with microliter precision and dual control modes.
                            </p>
                            <ul style="color: var(--text-secondary); margin-left: var(--space-lg); list-style-type: disc;">
                                <li><strong>Primary actuator</strong> - Plunger control with position feedback</li>
                                <li><strong>Secondary actuator</strong> - Tip ejection with force limiting</li>
                                <li><strong>Stepper motors</strong> - Control for repeatable actuation</li>
                                <li><strong>Mounting</strong> - Combined with quick swap holder</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Gallery -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-md); margin-top: var(--space-xl);">
                        <div style="text-align: center;">
                            <img src="../images/mechanical/RoboticPipette/pipettor_on_ur5e_close_up.png" alt="End Effector Close-up"
                                 class="lightbox-trigger"
                                 style="width: 100%; height: 120px; object-fit: cover; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); cursor: pointer;"
                                 onclick="openLightbox(this)">
                            <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: var(--space-xs);">Close-up</p>
                        </div>
                        <div style="text-align: center;">
                            <img src="../images/mechanical/RoboticPipette/pipettor_on_ur5e.png" alt="Complete System"
                                 class="lightbox-trigger"
                                 style="width: 100%; height: 120px; object-fit: cover; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); cursor: pointer;"
                                 onclick="openLightbox(this)">
                            <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: var(--space-xs);">Full System</p>
                        </div>
                        <div style="text-align: center;">
                            <img src="../images/mechanical/RoboticPipette/end_effectors_on_quick_swap_holder.png" alt="Quick Swap Holder"
                                 class="lightbox-trigger"
                                 style="width: 100%; height: 120px; object-fit: cover; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); cursor: pointer;"
                                 onclick="openLightbox(this)">
                            <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: var(--space-xs);">Quick Swap</p>
                        </div>
                        <div style="text-align: center;">
                            <img src="../images/mechanical/RoboticPipette/pipette_end_effector_cad.jpg" alt="CAD Design"
                                 class="lightbox-trigger"
                                 style="width: 100%; height: 120px; object-fit: cover; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); cursor: pointer;"
                                 onclick="openLightbox(this)">
                            <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: var(--space-xs);">CAD Model</p>
                        </div>
                        <div style="text-align: center;">
                            <img src="../images/mechanical/RoboticPipette/wingmantoolchange.png" alt="Tool Change System"
                                 class="lightbox-trigger"
                                 style="width: 100%; height: 120px; object-fit: cover; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); cursor: pointer;"
                                 onclick="openLightbox(this)">
                            <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: var(--space-xs);">Tool Change</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="position: relative; cursor: pointer;" class="video-lightbox-trigger" onclick="openVideoLightbox('../images/mechanical/RoboticPipette/actuate_close_up_cad.mp4', 'CAD Animation')">
                                <video
                                    preload="metadata"
                                    style="width: 100%; height: 120px; object-fit: cover; border-radius: var(--radius-md); box-shadow: var(--shadow-sm);">
                                    <source src="../images/mechanical/RoboticPipette/actuate_close_up_cad.mp4" type="video/mp4">
                                </video>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-play" style="color: white; font-size: 1rem; margin-left: 2px;"></i>
                                </div>
                            </div>
                            <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: var(--space-xs);">Animation</p>
                        </div>
                    </div>
                </div>

                <!-- Technical Challenges Section -->
                <div style="background: var(--bg-secondary); padding: var(--space-2xl); border-radius: var(--radius-lg); margin-bottom: var(--space-2xl);">
                    <h2 style="color: var(--accent-primary); margin-bottom: var(--space-lg);">
                        <i class="fas fa-exclamation-triangle"></i>
                        Technical Challenges & Solutions
                    </h2>
                    
                    <div style="display: grid; gap: var(--space-lg);">
                        <div style="background: var(--card-bg); padding: var(--space-lg); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">
                                <i class="fas fa-plug" style="color: var(--accent-primary); margin-right: var(--space-xs);"></i>
                                Quick Swap System Requirements
                            </h3>
                            <p style="color: var(--text-secondary); margin-bottom: var(--space-md);">
                                Quick swap capability drove the entire system architecture. Laboratory workflows require rapid switching between 
                                pipette volumes, but the UR5e tool exchanger prohibited external wires, forcing integration through the robot's 
                                internal 8-pin RS485 interface.
                            </p>
                            <ul style="color: var(--text-secondary); margin-left: var(--space-lg); list-style-type: disc; font-size: 0.875rem;">
                                <li>Researched internal wiring requirements and RS485 protocol</li>
                                <li>Implemented Arduino-based communication</li>
                                <li>Validated compatibility with existing laboratory grippers</li>
                            </ul>
                        </div>
                        
                        <div style="background: var(--card-bg); padding: var(--space-lg); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">
                                <i class="fas fa-crosshairs" style="color: var(--accent-primary); margin-right: var(--space-xs);"></i>
                                Precision & Integration
                            </h3>
                            <p style="color: var(--text-secondary);">
                                Achieved 5&micro;L accuracy through position-controlled linear actuators with force feedback, while integrating 
                                multiple software layers from low-level Arduino control to high-level ROS2 research scheduling systems.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Technology Stack -->
                <div id="software-focus" style="background: var(--card-bg); padding: var(--space-2xl); border-radius: var(--radius-lg); border: 1px solid var(--border-color); margin-bottom: var(--space-2xl);">
                    <h2 style="color: var(--accent-primary); margin-bottom: var(--space-lg);">
                        <i class="fas fa-tools"></i>
                        Technology Stack
                    </h2>
                    <div style="display: flex; flex-wrap: wrap; gap: var(--space-sm); margin-bottom: var(--space-lg);">
                        <span class="tech-tag">C++</span>
                        <span class="tech-tag">Arduino</span>
                        <span class="tech-tag">RS485</span>
                        <span class="tech-tag">Python</span>
                        <span class="tech-tag">ROS2</span>
                        <span class="tech-tag">MoveIt</span>
                        <span class="tech-tag">Bluesky</span>
                        <span class="tech-tag">EROBS</span>
                        <span class="tech-tag">Motor Control</span>
                        <span class="tech-tag">3D Printing</span>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-xl);">
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">Embedded Firmware</h3>
                            <ul style="color: var(--text-secondary); margin-left: var(--space-lg);">
                                <li>Arduino-based microcontroller</li>
                                <li>RS485 protocol implementation</li>
                                <li>Dual stepper motor control</li>
                                <li>Position feedback and limits</li>
                                <li>Command parsing and execution</li>
                            </ul>
                        </div>
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">Driver Layer</h3>
                            <ul style="color: var(--text-secondary); margin-left: var(--space-lg);">
                                <li>Python ROS2 service bridge</li>
                                <li>Serial communication protocol</li>
                                <li>MoveIt motion planning interface</li>
                                <li>High-level pipetting commands</li>
                                <li>Status feedback to ROS2</li>
                            </ul>
                        </div>
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">System Integration</h3>
                            <ul style="color: var(--text-secondary); margin-left: var(--space-lg);">
                                <li>EROBS scheduling integration</li>
                                <li>Bluesky protocol support</li>
                                <li>Automated workflow execution</li>
                                <li>UR5e tool exchanger compatible</li>
                                <li>Laboratory protocol automation</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div style="background: var(--bg-secondary); padding: var(--space-2xl); border-radius: var(--radius-lg); margin-bottom: var(--space-2xl);">
                    <h2 style="color: var(--accent-primary); margin-bottom: var(--space-lg);">
                        <i class="fas fa-chart-line"></i>
                        Results
                    </h2>
                    <div style="display: grid; gap: var(--space-lg);">
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-sm);">Achieved Performance</h3>
                            <p style="color: var(--text-secondary);">
                                Target accuracy of 50μL exceeded with achieved precision of 5μL ±0.5μL. System validated at
                                Brookhaven National Laboratory with full ROS2 compatibility and standard laboratory pipette integration.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- RS485 Communication Architecture -->
                <div style="background: var(--card-bg); padding: var(--space-2xl); border-radius: var(--radius-lg); border: 1px solid var(--border-color); margin-bottom: var(--space-2xl);">
                    <h2 style="color: var(--accent-primary); margin-bottom: var(--space-lg);">
                        <i class="fas fa-network-wired"></i>
                        Communication Architecture
                    </h2>
                    <p style="color: var(--text-secondary); margin-bottom: var(--space-lg);">
                        The tool exchanger quick-swap requirement drove development of a custom RS485-based communication system,
                        enabling internal wiring through the UR5e robot's 8-pin interface while maintaining compatibility with existing laboratory grippers.
                    </p>

                    <div style="display: grid; gap: var(--space-lg);">
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-sm);">Embedded Firmware</h3>
                            <p style="color: var(--text-secondary);">
                                Arduino-based microcontroller firmware implements RS485 protocol handling, parsing commands from the robot controller
                                and translating them to stepper motor control signals. The firmware manages dual actuator coordination for plunger
                                depression and tip ejection with position feedback and safety limits.
                            </p>
                        </div>
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-sm);">Python Driver Layer</h3>
                            <p style="color: var(--text-secondary);">
                                Python service bridges ROS2 MoveIt motion planning with low-level hardware control. The driver translates high-level
                                pipetting commands (aspirate, dispense, eject) into precise RS485 messages, handles serial communication protocol,
                                and provides status feedback to the ROS2 ecosystem.
                            </p>
                        </div>
                        <div>
                            <h3 style="color: var(--text-primary); margin-bottom: var(--space-sm);">System Integration</h3>
                            <p style="color: var(--text-secondary);">
                                Full integration with EROBS scheduling system and Bluesky experimental protocols enables automated liquid handling
                                workflows. The communication stack supports real-time operation with sub-second response times for scientific protocols.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Research Poster Section -->
                <div style="background: var(--card-bg); padding: var(--space-2xl); border-radius: var(--radius-lg); border: 1px solid var(--border-color); margin-bottom: var(--space-2xl);">
                    <h2 style="color: var(--accent-primary); margin-bottom: var(--space-lg);">
                        <i class="fas fa-presentation"></i>
                        Research Poster
                    </h2>
                    
                    <div style="text-align: center;">
                        <div style="background: var(--bg-secondary); padding: var(--space-lg); border-radius: var(--radius-lg); margin-bottom: var(--space-lg);">
                            <div style="max-width: 800px; margin: 0 auto;">
                                <embed 
                                    src="../images/mechanical/RoboticPipette/Xiao_Y_poster_final.pdf" 
                                    type="application/pdf" 
                                    width="100%" 
                                    height="600px"
                                    style="border-radius: var(--radius-md); box-shadow: var(--shadow-lg);">
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); font-style: italic; font-size: 0.875rem; text-align: center; max-width: 600px; margin: 0 auto; line-height: 1.5;">
                            Research poster presented at Brookhaven National Laboratory showcasing the robotic pipette end effector project.
                        </p>
                    </div>
                </div>

                <!-- Project Impact -->
                <div style="background: var(--accent-primary); color: var(--bg-primary); padding: var(--space-2xl); border-radius: var(--radius-lg); margin-bottom: var(--space-2xl); text-align: center;">
                    <h2 style="margin-bottom: var(--space-lg); color: var(--bg-primary);">
                        <i class="fas fa-trophy"></i>
                        Project Impact
                    </h2>
                    <p style="margin: 0; font-size: 1.125rem; color: var(--bg-primary);">
                        Bridged industrial robotics and laboratory precision, enabling <strong>automated scientific protocols</strong> 
                        through <strong>interdisciplinary engineering</strong> combining mechanical design, embedded programming, and modern robotics frameworks.
                    </p>
                </div>

                <!-- Navigation -->
                <div class="btn-group" style="justify-content: center; margin-top: var(--space-2xl);">
                    <a href="RocketTeam.html" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i>
                        Next Project
                    </a>
                    <a href="../mechanical.html" class="btn btn-secondary">
                        <i class="fas fa-cog"></i>
                        Mechanical Projects
                    </a>
                    <a href="../software.html" class="btn btn-secondary">
                        <i class="fas fa-code"></i>
                        Software Projects
                    </a>
                    <a href="../index.html" class="btn btn-secondary">
                        <i class="fas fa-home"></i>
                        Home
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <div class="lightbox-content" onclick="event.stopPropagation()">
            <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
            <img id="lightbox-image" class="lightbox-image" src="" alt="" style="display: none;">
            <video id="lightbox-video" class="lightbox-video" controls style="display: none; max-width: 90vw; max-height: 90vh;">
                <source id="lightbox-video-source" src="" type="video/mp4">
            </video>
            <div id="lightbox-caption" class="lightbox-caption"></div>
        </div>
    </div>    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 Eric Xiao. All rights reserved.</p>
                <p>I like to game, walk my dog Mochi, and cook in my spare time.</p>
                <p style="margin-top: var(--space-md);"><a href="../directory.html" style="color: var(--accent-primary);">Project Directory</a></p>
            </div>

            <!-- Social Links -->
            <div class="social-links">
                <a href="https://www.linkedin.com/in/eric-xiaoy/" class="social-link" title="LinkedIn">
                    <i class="fab fa-linkedin"></i>
                </a>
                <a href="https://github.com/sixym3" class="social-link" title="GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <a href="https://www.instagram.com/sixym3/" class="social-link" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://x.com/cyberbroker4729" class="social-link" title="Twitter">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="https://www.instagram.com/mochi_is_a_shiba_inu" class="social-link" title="Mochi's Instagram">
                    <i class="fas fa-paw"></i>
                </a>
            </div>
        </div>
    </footer>

    <!-- Additional Mobile Responsive CSS -->
    <style>
        /* Video lightbox trigger styling */
        .video-lightbox-trigger:hover div {
            background: rgba(0,0,0,0.9) !important;
            transform: translate(-50%, -50%) scale(1.1) !important;
        }
        
        /* Lightbox video styling */
        .lightbox-video {
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
        }
        
        /* Desktop hero video styling - smaller and more compact */
        @media (min-width: 769px) {
            .hero-video {
                max-height: 300px !important;
                max-width: 500px !important;
                margin: 0 auto !important;
                display: block !important;
            }
        }
        
        @media (max-width: 768px) {
            .responsive-grid-2, .responsive-grid-3, .responsive-grid-2-1 {
                grid-template-columns: 1fr !important;
                gap: var(--space-lg) !important;
            }
            
            /* Hero video on mobile - allow full width */
            .hero-video {
                max-height: none !important;
                max-width: 100% !important;
            }
            
            /* Make video container more mobile friendly */
            .video-container {
                padding: var(--space-md) !important;
            }
            
            /* Adjust lightbox triggers for touch devices */
            .lightbox-trigger, .video-lightbox-trigger {
                transition: none !important;
            }
            
            .lightbox-trigger:hover, .video-lightbox-trigger:hover {
                transform: none !important;
            }
            
            .video-lightbox-trigger:hover div {
                transform: translate(-50%, -50%) !important;
                background: rgba(0,0,0,0.7) !important;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 var(--space-sm) !important;
            }
        }
    </style>

    <!-- JavaScript -->
    <script>
        // Mobile Navigation Toggle
        const navToggle = document.getElementById('nav-toggle');
        const navMenu = document.getElementById('nav-menu');
        
        navToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });

        // Close mobile menu when clicking on a link
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });

        // Navbar background on scroll
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.style.background = 'rgba(10, 10, 10, 0.98)';
            } else {
                navbar.style.background = 'rgba(10, 10, 10, 0.95)';
            }
        });

        // Lightbox functionality for images
        function openLightbox(img) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxVideo = document.getElementById('lightbox-video');
            const lightboxCaption = document.getElementById('lightbox-caption');
            
            // Hide video, show image
            lightboxVideo.style.display = 'none';
            lightboxVideo.pause();
            lightboxImage.style.display = 'block';
            
            lightbox.style.display = 'block';
            lightboxImage.src = img.src;
            lightboxImage.alt = img.alt;
            lightboxCaption.textContent = img.alt;
            
            // Prevent body scroll when lightbox is open
            document.body.style.overflow = 'hidden';
        }

        // Lightbox functionality for videos
        function openVideoLightbox(videoSrc, caption) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxVideo = document.getElementById('lightbox-video');
            const lightboxVideoSource = document.getElementById('lightbox-video-source');
            const lightboxCaption = document.getElementById('lightbox-caption');
            
            // Hide image, show video
            lightboxImage.style.display = 'none';
            lightboxVideo.style.display = 'block';
            
            lightbox.style.display = 'block';
            lightboxVideoSource.src = videoSrc;
            lightboxVideo.load(); // Reload video with new source
            lightboxCaption.innerHTML = caption; // Use innerHTML to support HTML entities
            
            // Prevent body scroll when lightbox is open
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            const lightboxVideo = document.getElementById('lightbox-video');
            
            // Pause video if playing
            lightboxVideo.pause();
            
            lightbox.style.display = 'none';
            
            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

        // Close lightbox with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeLightbox();
            }
        });

        // Handle anchor-based navigation for targeted entry points
        function handleAnchorNavigation() {
            const hash = window.location.hash;
            if (hash === '#mechanical-focus') {
                document.getElementById('mechanical-focus').scrollIntoView({ behavior: 'smooth' });
                // Update navigation to show mechanical active
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                document.querySelector('a[href="../mechanical.html"]').classList.add('active');
            } else if (hash === '#software-focus') {
                // Start at top to show there's content above, then smoothly scroll to software section
                window.scrollTo({ top: 0, behavior: 'instant' });
                
                // Update navigation to show software active  
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                document.querySelector('a[href="../software.html"]').classList.add('active');
                
                // After a brief delay to show top content, scroll to software section
                setTimeout(() => {
                    document.getElementById('software-focus').scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 800); // 800ms delay to let users see the top content
            }
        }

        // Handle anchor navigation on page load and hash changes
        window.addEventListener('load', handleAnchorNavigation);
        window.addEventListener('hashchange', handleAnchorNavigation);
    </script>
</body>
</html>